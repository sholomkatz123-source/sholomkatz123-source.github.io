generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  STAFF
}

model User {
  id           String   @id @default(cuid())
  username     String   @unique
  passwordHash String
  role         Role     @default(STAFF)
  createdAt    DateTime @default(now())
}

model Family {
  id         String   @id @default(cuid())
  familyId   String   @unique
  lastName   String
  fatherName String
  motherName String?
  address    String
  homePhone  String?
  fatherCell String?
  motherCell String?
  createdAt  DateTime @default(now())

  children    Child[]
  enrollments Enrollment[]
  billings    Billing[]
  payments    Payment[]
}

model Child {
  id        String  @id @default(cuid())
  childId   String  @unique
  childName String
  age       Int?
  grade     String?
  school    String?

  familyId  String
  family    Family  @relation(fields: [familyId], references: [id], onDelete: Cascade)

  enrollments Enrollment[]
  billings    Billing[]
  payments    Payment[]
}

model Program {
  id          String  @id @default(cuid())
  programId   String  @unique
  programName String
  cost        Decimal @db.Decimal(10,2)
  enrollments Enrollment[]
}

model Enrollment {
  id          String   @id @default(cuid())
  childId     String
  familyId    String
  programId   String
  date        DateTime @default(now())

  child       Child    @relation(fields: [childId], references: [id], onDelete: Cascade)
  family      Family   @relation(fields: [familyId], references: [id], onDelete: Cascade)
  program     Program  @relation(fields: [programId], references: [id], onDelete: Restrict)
  billings    Billing[]
}

model Billing {
  id            String   @id @default(cuid())
  familyId      String
  childId       String?
  enrollmentId  String?
  description   String?
  chargeAmount  Decimal  @db.Decimal(10,2)
  date          DateTime @default(now())

  family      Family     @relation(fields: [familyId], references: [id], onDelete: Cascade)
  child       Child?     @relation(fields: [childId], references: [id], onDelete: SetNull)
  enrollment  Enrollment?@relation(fields: [enrollmentId], references: [id], onDelete: SetNull)
}

model Payment {
  id        String   @id @default(cuid())
  familyId  String
  childId   String?
  amount    Decimal  @db.Decimal(10,2)
  type      String?
  notes     String?
  date      DateTime @default(now())

  family    Family   @relation(fields: [familyId], references: [id], onDelete: Cascade)
  child     Child?   @relation(fields: [childId], references: [id], onDelete: SetNull)
}
